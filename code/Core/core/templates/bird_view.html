<div id="bird-view"></div>
<script src="https://d3js.org/d3.v6.min.js"></script>
<script>
  var nodes = [
    {% for node in graph.nodes %}
    {
      id: "{{ node.id }}",
      name: "{{ node.name }}",
      x: {{ node.x }},
      y: {{ node.y }}
    },
    {% endfor %}
  ];

  var links = [
    {% for link in graph.links %}
    {
      source: "{{ link.source }}",
      target: "{{ link.target }}"
    },
    {% endfor %}
  ];

  var width = 200;
  var height = 200;

  var svg = d3
    .select("#bird-view")
    .append("svg")
    .attr("width", width)
    .attr("height", height);

  var link = svg
    .selectAll(".link")
    .data(links)
    .enter()
    .append("line")
    .attr("class", "link")
    .style("stroke", "#888")
    .style("stroke-width", 1);

  var node = svg
    .selectAll(".node")
    .data(nodes)
    .enter()
    .append("circle")
    .attr("class", "node")
    .attr("r", 2)
    .attr("cx", d => d.x)
    .attr("cy", d => d.y)
    .style("fill", "green");

  var simulation = d3
    .forceSimulation(nodes)
    .force("link", d3.forceLink(links).id(d => d.id))
    .force("charge", d3.forceManyBody().strength(-10))
    .force("center", d3.forceCenter(width / 2, height / 2))
    .force("collide", d3.forceCollide().radius(3))
    .stop();

  for (let i = 0; i < 100; ++i) {
    simulation.tick();
  }

  link
    .attr("x1", d => d.source.x)
    .attr("y1", d => d.source.y)
    .attr("x2", d => d.target.x)
    .attr("y2", d => d.target.y);

  node.attr("cx", d => d.x).attr("cy", d => d.y);
</script>
